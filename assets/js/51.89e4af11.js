(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{402:function(t,a,s){"use strict";s.r(a);var n=s(42),r=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"关键渲染路径"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关键渲染路径"}},[t._v("#")]),t._v(" 关键渲染路径")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("解释")]),t._v(" "),s("p",[t._v("关键渲染路径(Critical Rendering Path)：是指浏览器呈现网页要经历的一系列步骤")])]),t._v(" "),s("h2",{attrs:{id:"html-dom"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#html-dom"}},[t._v("#")]),t._v(" HTML -> DOM")]),t._v(" "),s("p",[t._v("字节 → 字符 → 令牌 → 节点 → 对象模型，生成了文档对象模型")]),t._v(" "),s("p",[t._v("HTML response > Tokens > Nodes > DOM Tree")]),t._v(" "),s("p",[t._v("浏览器会"),s("strong",[t._v("逐步构建 DOM")]),t._v(",通过这一点来优化生成网页的速度。即不用等所有 HTML 的都好了之后在处理，返回部分 HTML 是个很好的性能优化策略")]),t._v(" "),s("h2",{attrs:{id:"css-cssom"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#css-cssom"}},[t._v("#")]),t._v(" CSS -> CSSOM")]),t._v(" "),s("p",[t._v("因为 CSS 会依据层级关系重新定义和优化样式属性,如果使用 CSS 部分树，会导致网页的样式渲染不正常，所以浏览器需解析全部资源内容才能进行渲染树的构建。即 CSS 为一种渲染阻塞资源(render blocking resource)")]),t._v(" "),s("p",[s("strong",[t._v("CSS 是阻塞渲染的资源。需要将它尽早、尽快地下载到客户端，以便缩短首次渲染的时间")])]),t._v(" "),s("h2",{attrs:{id:"render-tree"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#render-tree"}},[t._v("#")]),t._v(" Render Tree")]),t._v(" "),s("p",[t._v("渲染树(CSSOM 树和 DOM 树合并)最重要的特性就是仅捕获可见内容。渲染树是 DOM 和 CSSOM 的结合，是最终能渲染到页面的元素的树形结构表示。也就是说，它包含能在"),s("strong",[t._v("页面中最终呈现的元素")]),t._v("，而不包含那些用 CSS 样式隐藏的元素，比如带有 display: none;属性的元素。")]),t._v(" "),s("h2",{attrs:{id:"layout"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#layout"}},[t._v("#")]),t._v(" Layout")]),t._v(" "),s("p",[t._v("根据渲染树来布局，以计算每个节点的几何信息,将各个节点绘制到屏幕上")]),t._v(" "),s("p",[s("code",[t._v('<meta name="viewport" content="width=device-width, initial-scale=1">')])]),t._v(" "),s("p",[t._v("告诉浏览器布局视口的宽度应该等于设备的宽度，如果没有设置，浏览器就会使用默认视口宽度 980px")]),t._v(" "),s("h2",{attrs:{id:"javascript"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#javascript"}},[t._v("#")]),t._v(" JavaScript")]),t._v(" "),s("p",[t._v("JavaScript 允许我们修改网页的方方面面：内容、样式以及它如何响应用户交互。 不过，"),s("strong",[t._v("JavaScript 也会阻止 DOM 构建和延缓网页渲染")])]),t._v(" "),s("ul",[s("li",[t._v("JavaScript 可以查询和修改 DOM 与 CSSOM")]),t._v(" "),s("li",[t._v("JavaScript 执行会阻止 CSSOM。")]),t._v(" "),s("li",[t._v("除非将 JavaScript 显式声明为异步，否则它会阻止构建 DOM")])]),t._v(" "),s("h3",{attrs:{id:"javascript-为什么放在页面底部"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#javascript-为什么放在页面底部"}},[t._v("#")]),t._v(" Javascript 为什么放在页面底部")]),t._v(" "),s("p",[t._v("我们的脚本在文档的何处插入，就在何处执行。当 HTML 解析器遇到一个 script 标记时，它会暂停构建 DOM，将控制权移交给 JavaScript 引擎；等 JavaScript 引擎运行完毕，浏览器会从中断的地方恢复 DOM 构建。")]),t._v(" "),s("p",[t._v("换言之，我们的脚本块找不到网页中任何靠后的元素，因为它们尚未接受处理！或者，稍微换个说法：执行我们的内联脚本会阻止 DOM 构建，也就延缓了首次渲染。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("如果浏览器尚未完成 CSSOM 的下载和构建，而我们却想在此时运行脚本，会怎样？")]),t._v(" "),s("p",[t._v("答案很简单，对性能不利：浏览器将延迟脚本执行和 DOM 构建，直至其完成 CSSOM 的下载和构建")]),t._v(" "),s("p",[t._v("向 script 标记添加异步关键字可以指示浏览器在等待脚本可用期间不阻止 DOM 构建，这样可以显著提升性能，eg: "),s("code",[t._v('<script src="app.js" async><\/script>')])])]),t._v(" "),s("h2",{attrs:{id:"重排和重绘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重排和重绘"}},[t._v("#")]),t._v(" 重排和重绘")]),t._v(" "),s("ul",[s("li",[t._v("重排：部分渲染树（或者整个渲染树）需要重新分析并且"),s("strong",[t._v("节点尺寸需要重新计算")])]),t._v(" "),s("li",[t._v("重绘：由于节点的几何属性发生改变或者由于样式发生改变，例如改变元素背景色时，屏幕上的部分内容需要更新")])]),t._v(" "),s("h3",{attrs:{id:"触发重排和重绘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#触发重排和重绘"}},[t._v("#")]),t._v(" 触发重排和重绘")]),t._v(" "),s("blockquote",[s("p",[t._v("获取布局信息的操作会导致强制刷新队列，使得浏览器不得不执行渲染队列中的“待处理变化”并触发重排以返回正确的值 eg: offsetTop,scrollTop,clientTop,getComputedStyle")])]),t._v(" "),s("ul",[s("li",[t._v("添加、删除、更新 DOM 节点")]),t._v(" "),s("li",[t._v("通过 display: none 隐藏一个 DOM 节点-触发重排和重绘")]),t._v(" "),s("li",[t._v("通过 visibility: hidden 隐藏一个 DOM 节点-只触发重绘，因为没有几何变化")]),t._v(" "),s("li",[t._v("移动或者给页面中的 DOM 节点添加动画")]),t._v(" "),s("li",[t._v("添加一个样式表，调整样式属性")]),t._v(" "),s("li",[t._v("用户行为，例如调整窗口大小，改变字号，或者滚动")])]),t._v(" "),s("h3",{attrs:{id:"优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优化"}},[t._v("#")]),t._v(" 优化")]),t._v(" "),s("ul",[s("li",[t._v("不要逐个变样式。对于静态页面来说，明智且兼具可维护性的做法是改变类名而不是样式")]),t._v(" "),s("li",[t._v("“离线”的批量改变和表现 DOM。“离线”意味着不在当前的 DOM 树中做修改。你可以：\n"),s("ul",[s("li",[t._v("通过 documentFragment 来保留临时变动")]),t._v(" "),s("li",[t._v("复制你即将更新的节点，在副本上工作，然后将之前的节点和新节点交换")]),t._v(" "),s("li",[t._v("通过 display:none 属性隐藏元素（只有一次重排重绘），添加足够多的变更后，通过 display 属性显示（另一次重排重绘）。通过这种方式即使大量变更也只触发两次重排")])])]),t._v(" "),s("li",[t._v("通常情况下，考虑一下渲染树和变更后需要重新验证的消耗。举个例子，使用绝对定位会使得该元素单独成为渲染树中 body 的一个子元素，所以当你对其添加动画时，它不会对其它节点造成太多影响。当你在这些节点上放置这个元素时，一些其它在这个区域内的节点可能需要重绘，但是不需要重排。")])]),t._v(" "),s("h2",{attrs:{id:"ui-线程和-js-线程并不是同一个线程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ui-线程和-js-线程并不是同一个线程"}},[t._v("#")]),t._v(" UI 线程和 JS 线程并不是同一个线程")]),t._v(" "),s("p",[t._v("UI 线程与 JS 线程是互斥的，因为 JS 运行结果会影响到 UI 线程的结果，互斥的实现方式大概是当 JS 引擎执行时，GUI 线程会被挂起，GUI 更新会被保存在一个队列中等到 JS 引擎空闲时立即被执行")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("demo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("backgroundColor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"red"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" now "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Date"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Date"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" now "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("backgroundColor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("continue")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("backgroundColor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"blue"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("demo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/?hl=zh-cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("Google 关键渲染路径文档"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);