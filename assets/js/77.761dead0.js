(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{336:function(e,r,t){"use strict";t.r(r);var a=t(38),o=Object(a.a)({},function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h2",{attrs:{id:"启用-desktop-pwas"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启用-desktop-pwas","aria-hidden":"true"}},[e._v("#")]),e._v(" 启用 Desktop PWAs")]),e._v(" "),t("p",[e._v("chrome 访问"),t("code",[e._v("chrome://flags/")]),e._v("，将"),t("code",[e._v("Desktop PWAs")]),e._v("设置为"),t("code",[e._v("Enabled")])]),e._v(" "),t("h2",{attrs:{id:"理论"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#理论","aria-hidden":"true"}},[e._v("#")]),e._v(" 理论")]),e._v(" "),t("h3",{attrs:{id:"缓存时机"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缓存时机","aria-hidden":"true"}},[e._v("#")]),e._v(" 缓存时机")]),e._v(" "),t("ul",[t("li",[e._v("install 时")]),e._v(" "),t("li",[e._v("用户交互时")]),e._v(" "),t("li",[e._v("网络响应时")])]),e._v(" "),t("h3",{attrs:{id:"缓存策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缓存策略","aria-hidden":"true"}},[e._v("#")]),e._v(" 缓存策略")]),e._v(" "),t("p",[e._v("无论您缓存多少内容 ServiceWorker 都不会使用缓存，除非您指示它在何时使用缓存以及如何使用")]),e._v(" "),t("ul",[t("li",[e._v("全部来自缓存")]),e._v(" "),t("li",[e._v("全部来自网络")]),e._v(" "),t("li",[e._v("取缓存的内容失败了再去请求网络")]),e._v(" "),t("li",[e._v("请求网络失败了去请求缓存")]),e._v(" "),t("li",[e._v("两个一起请求看谁快")]),e._v(" "),t("li",[e._v("先去取缓存，然后再去请求网络")]),e._v(" "),t("li",[e._v("两个都失败了，就只好做一个错误处理，叫 Generic fallback")])]),e._v(" "),t("h3",{attrs:{id:"service-workers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#service-workers","aria-hidden":"true"}},[e._v("#")]),e._v(" Service Workers")]),e._v(" "),t("p",[e._v("Service Worker 提供了丰富的离线体验。但是技术的发展从来都不是孤立的。在 SW 出现之前，HTML5 也提供了页面缓存方案，开发者们使用  "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTML/Using_the_application_cache",target:"_blank",rel:"noopener noreferrer"}},[e._v("Application Cache (AppCache)"),t("OutboundLink")],1),e._v("接口缓存资源，由于它有很多"),t("a",{attrs:{href:"https://www.zhihu.com/question/29876535",target:"_blank",rel:"noopener noreferrer"}},[e._v("缺点"),t("OutboundLink")],1),e._v(",不过已经不推荐使用了")]),e._v(" "),t("p",[e._v("Service Workers 就是浏览器在后台运行的脚本,你可以把它看作是至于浏览器和服务器之间的中间件")]),e._v(" "),t("p",[e._v("其"),t("a",{attrs:{href:"https://blog.bitsrc.io/understanding-service-workers-and-caching-strategies-a6c1e1cbde03",target:"_blank",rel:"noopener noreferrer"}},[e._v("生命周期"),t("OutboundLink")],1),e._v("如下图：\n"),t("img",{attrs:{src:"https://developers.google.com/web/fundamentals/primers/service-workers/images/sw-lifecycle.png",alt:"生命周期"}})]),e._v(" "),t("h3",{attrs:{id:"manifest"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#manifest","aria-hidden":"true"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://developers.google.com/web/fundamentals/web-app-manifest/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Manifest"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("然后修改 Manifest 文件，注意一定要有 "),t("strong",[e._v("144x144")]),e._v("或者以上大小 的 PNG 图标（我就是犯了这个错误），如果你不知道你的"),t("code",[e._v("Manifest")]),e._v("文件哪里有问题，可以通过"),t("code",[e._v("chrome")]),e._v("的 "),t("code",[e._v("DevTool -> Application -> Manifest")]),e._v(" 查看情况")]),e._v(" "),t("h2",{attrs:{id:"基础"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基础","aria-hidden":"true"}},[e._v("#")]),e._v(" 基础")]),e._v(" "),t("h3",{attrs:{id:"安装和卸载-pwa-应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装和卸载-pwa-应用","aria-hidden":"true"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://www.howtogeek.com/fyi/how-to-install-progressive-web-apps-pwas-in-chrome/",target:"_blank",rel:"noopener noreferrer"}},[e._v("安装和卸载 PWA 应用"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("PS: 为啥说这个，因为"),t("code",[e._v("beforeinstallprompt")]),e._v("事件在 PWA 应用已经安装的情况下不触发")]),e._v(" "),t("h3",{attrs:{id:"引导用户安装-pwa-应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#引导用户安装-pwa-应用","aria-hidden":"true"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://love2dev.com/blog/beforeinstallprompt/",target:"_blank",rel:"noopener noreferrer"}},[e._v("引导用户安装 PWA 应用"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("需要监听"),t("code",[e._v("BeforeInstallPromptEvent")]),e._v("事件，但是这个\n"),t("a",{attrs:{href:"https://stackoverflow.com/questions/50762626/pwa-beforeinstallprompt-not-called",target:"_blank",rel:"noopener noreferrer"}},[e._v("事件触发时机要求"),t("OutboundLink")],1),e._v("很多")]),e._v(" "),t("ul",[t("li",[e._v("你的 PWA APP 没有被安装")]),e._v(" "),t("li",[e._v("用户至少和你的网站交互了 30 秒以上")]),e._v(" "),t("li",[e._v("你的网站包含"),t("code",[e._v("manifest")]),e._v("文件")]),e._v(" "),t("li",[e._v("你的网站是 HTTPS 连接的")]),e._v(" "),t("li",[e._v("你已经注册了 SW")])]),e._v(" "),t("h2",{attrs:{id:"用-react-开发-pwa"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用-react-开发-pwa","aria-hidden":"true"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"(https://blog.bitsrc.io/build-progressive-web-apps-with-react-part-1-63f1fbc564a6)"}},[e._v("用 React 开发 PWA")])]),e._v(" "),t("h3",{attrs:{id:"开发-sw"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开发-sw","aria-hidden":"true"}},[e._v("#")]),e._v(" 开发 SW")]),e._v(" "),t("p",[e._v("create-react-app 生成的 service-worker.js 文件仅仅在生产模式可以使用。"),t("a",{attrs:{href:"https://github.com/facebook/create-react-app/issues/2396",target:"_blank",rel:"noopener noreferrer"}},[e._v("原因是"),t("OutboundLink")],1),e._v("service-worker.js 在生产环境下会导致很多不可意料的错误")]),e._v(" "),t("p",[e._v("react 仅在 production 模式注册 sw。所以通过"),t("code",[e._v("yarn build")]),e._v("，进入生产模式然后通过"),t("code",[e._v("serve -s build")]),e._v("来开发的。（如果你没有安装 serve，可以安装一下或者起一个别的静态服务器）")]),e._v(" "),t("h3",{attrs:{id:"更新-service-worker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更新-service-worker","aria-hidden":"true"}},[e._v("#")]),e._v(" 更新 Service Worker")]),e._v(" "),t("ul",[t("li",[e._v("谷歌控制台 application 里面勾选 Update on Reload")]),e._v(" "),t("li",[e._v("移除 service worker，然后让 sw 重新安装")])]),e._v(" "),t("h3",{attrs:{id:"复写-create-react-app-配置而不是-eject"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#复写-create-react-app-配置而不是-eject","aria-hidden":"true"}},[e._v("#")]),e._v(" 复写 create-react-app 配置而不是 eject")]),e._v(" "),t("p",[e._v("create-react-app(CRA) 默认的 sw 配置是缓存静态资源，但是很显然不满足我的需要")]),e._v(" "),t("p",[e._v("为什么要复写配置，完全可以重新写一个 service-worker-custom.js 文件然后注册它不就可以了？")]),e._v(" "),t("p",[e._v("答案是最好不要，因为"),t("code",[e._v("workbox-webpack-plugin")]),e._v("已经集成到"),t("code",[e._v("react-create-app")]),e._v("的"),t("a",{attrs:{href:"https://facebook.github.io/create-react-app/docs/making-a-progressive-web-app",target:"_blank",rel:"noopener noreferrer"}},[e._v("生产配置里面了"),t("OutboundLink")],1),e._v("，你可以通过修改配置的方式，来使用 google 提供的"),t("a",{attrs:{href:"https://developers.google.com/web/tools/workbox/modules/workbox-sw",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("Workbox")]),t("OutboundLink")],1),e._v("，帮助你实现自定义的 sw")]),e._v(" "),t("p",[e._v("推荐一个工具"),t("a",{attrs:{href:"https://github.com/timarney/react-app-rewired",target:"_blank",rel:"noopener noreferrer"}},[e._v("react-app-rewired"),t("OutboundLink")],1)]),e._v(" "),t("h3",{attrs:{id:"使用-google-的工具workbox"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-google-的工具workbox","aria-hidden":"true"}},[e._v("#")]),e._v(" 使用 google 的工具"),t("a",{attrs:{href:"(https://developers.google.com/web/tools/workbox/modules/workbox-strategies)"}},[e._v("workbox")])]),e._v(" "),t("p",[e._v("还是要在强调一点，"),t("code",[e._v("workbox-webpack-plugin")]),e._v("已经内置，所以你可能需要配置一下 eslint，防止报错")])])},[],!1,null,null,null);r.default=o.exports}}]);