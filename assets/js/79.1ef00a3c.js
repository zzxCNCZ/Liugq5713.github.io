(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{429:function(s,t,a){"use strict";a.r(t);var n=a(42),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"crossorigin-属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#crossorigin-属性"}},[s._v("#")]),s._v(" crossorigin 属性")]),s._v(" "),a("p",[s._v("最近一直在做水印的功能，把原先上传到七牛云上的图片绘制到"),a("code",[s._v("canvas")]),s._v("上，叠加水印之后在上传到七牛云上，但是出现了图片跨域的错误")]),s._v(" "),a("p",[s._v("在没有 CORS 批准的情况下从另一个来源加载任何数据而将画布绘制到画布中，画布就会受到污染。")]),s._v(" "),a("p",[s._v("在受污染的画布上调用以下任何一项将导致错误：")]),s._v(" "),a("ul",[a("li",[s._v("调用 getImageData()画布的上下文")]),s._v(" "),a("li",[s._v("调用 toBlob()上的"),a("code",[s._v("<canvas>")]),s._v("元素本身")]),s._v(" "),a("li",[s._v("toDataURL()在画布上调用")])]),s._v(" "),a("p",[s._v("所以当你碰到图片跨域的情况的时候，设置"),a("code",[s._v("image")]),s._v("标签的"),a("code",[s._v("crossorigin")]),s._v("属性为"),a("code",[s._v("anonymous")]),s._v("试试")]),s._v(" "),a("h2",{attrs:{id:"image标签的crossorigin属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#image标签的crossorigin属性"}},[s._v("#")]),s._v(" "),a("code",[s._v("image")]),s._v("标签的"),a("code",[s._v("crossorigin")]),s._v("属性")]),s._v(" "),a("p",[s._v("此枚举属性指示是否必须使用 CORS 完成相关图像的提取。支持 CORS 的图像可以在"),a("code",[s._v("<canvas>")]),s._v("元素中重复使用而不会被“  污染”")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.zhangxinxu.com/wordpress/2018/02/crossorigin-canvas-getimagedata-cors/comment-page-1/",target:"_blank",rel:"noopener noreferrer"}},[s._v("anonymous"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("执行跨源请求（即，使用 Origin:HTTP 头），但不发送凭证（即，没有 cookie，X.509 证书或 HTTP 基本认证）。如果服务器未向源站点提供凭据（通过不设置 Access-Control-Allow-Origin HTTP 标头），则图像将受到污染并且其使用受到限制。")]),s._v(" "),a("p",[s._v("PS: 注意服务器也要设置"),a("code",[s._v("Access-Control-Allow-Origin")]),s._v("标头，我今天调用启信宝的 API 获取图片使用的时候，就怎么都是跨域失败，可能它就是没有设置这个 HTTP 标头")]),s._v(" "),a("h2",{attrs:{id:"script-标签的crossorigin的属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#script-标签的crossorigin的属性"}},[s._v("#")]),s._v(" "),a("code",[s._v("script")]),s._v(" 标签的"),a("code",[s._v("crossorigin")]),s._v("的属性")]),s._v(" "),a("p",[s._v("Normal script elements pass minimal information to the window.onerror for scripts which do not pass the standard CORS checks. To allow error logging for sites which use a separate domain for static media, use this attribute. See CORS settings attributes for a more descriptive explanation of its valid arguments.")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/rainjay/blog/issues/1",target:"_blank",rel:"noopener noreferrer"}},[s._v("解释"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("crossorigin 的属性值可以是 anonymous、use-credentials，如果没有属性值或者非法属性值，会被浏览器默认做 anonymous。crossorigin 的作用有三个：")]),s._v(" "),a("p",[s._v("crossorigin 会让浏览器启用 CORS 访问检查，检查 http 相应头的"),a("code",[s._v("Access-Control-Allow-Origin")]),s._v("，对于传统 script 需要跨域获取的 js 资源，控制暴露出其报错的详细信息。")]),s._v(" "),a("p",[s._v("对于 module script，控制用于跨域请求的凭据模式。我们在收集错误日志的时候，通常会在 window 上注册一个方法来监测所有代码抛出的异常：")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"error"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" lineno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" colno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" string "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("toLowerCase")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" substring "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"script error"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("indexOf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("substring"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Script Error: See Browser Console for Detail"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" message "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      Message"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      Line"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" lineNo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      Column"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" columnNo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Error object"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// send error log to server")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("record")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("但是对于跨域 js 来说，只会给出很少的报错信息：'error: script error'，通过使用 crossorigin 属性可以使跨域 js 暴露出跟同域 js 同样的报错信息。但是，资源服务器必须返回一个 Access-Control-Allow-Origin 的 header，否则资源无法访问。")])])}),[],!1,null,null,null);t.default=r.exports}}]);